<div>
  <mat-card class="mat-elevation-z2" style="margin-bottom: 24px;" >
    <mat-card-header *ngIf="fusionYield; else invalidCombo">
      <mat-card-title>{{ fusionYield.persona.name }}</mat-card-title>
      <mat-card-subtitle
        >{{ arcanaName(fusionYield.persona.arcana) }} / Level
        {{ fusionYield.persona.level }}</mat-card-subtitle
      >
    </mat-card-header>
    <ng-template #invalidCombo>
      <mat-card-header>
        <mat-card-title>{{ fusionItems.length < 2 ? 'Add items' : 'Invalid combo' }}</mat-card-title>
        <mat-card-subtitle>
          {{ fusionItems.length < 2 ? 'At least two items are needed to proceed.' : 'Cannot fuse current items.'}}
        </mat-card-subtitle>
      </mat-card-header>
    </ng-template>
    <mat-chip-list *ngIf="fusionYield">
      <mat-chip *ngIf="fusionYield.persona.special" color="warn" selected
        >Special fusion</mat-chip
      >
      <mat-chip *ngIf="fusionYield.persona.specialCondition" color="accent" selected>{{
        fusionYield.persona.specialCondition
      }}</mat-chip>
      <mat-chip *ngIf="fusionYield.persona.ultimate" color="accent" selected
        >Ultimate Persona</mat-chip
      >
      <mat-chip *ngIf="fusionYield.persona.keyItem">Key item</mat-chip>
    </mat-chip-list>
    <mat-card-content></mat-card-content>
  </mat-card>  

  <div>
    <mat-accordion multi>
      <mat-expansion-panel *ngFor="let fusionItem of fusionItems; let i = index;">
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ fusionItem.persona.name }}
          </mat-panel-title>
          <mat-panel-description>
             Level {{ fusionItem.currentLevel }} / {{ arcanaName(fusionItem.persona.arcana) }}
          </mat-panel-description>
        </mat-expansion-panel-header>

        <div>
          <mat-form-field class="example-full-width">
            <mat-label>Current Level</mat-label>
            <input type="number" autocomplete="off" matInput
            [(ngModel)]="fusionItem.currentLevel"
            (change)="changeLevel($event, fusionItem)"
            (keydown.enter)="$event.target.blur();false"
            [value]="fusionItem.currentLevel"
            [min]="fusionItem.persona.level"
            max="99"
            required>
          </mat-form-field>
          <div style="width: 100%; display: flex; flex-direction: row; justify-content: flex-end;">
            <button mat-button color="primary" (click)="changePersona(fusionItem)">CHANGE</button>
            <button mat-button color="warn" (click)="removeItem(i)">REMOVE</button>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>

    <button mat-flat-button color="primary" style="margin-top: 16px; width: 100%" (click)="addItem()">
      <mat-icon>add</mat-icon> ADD
    </button>

    <button mat-stroked-button color="warn" style="margin-top: 16px; width: 100%" (click)="clearItems()">
      <mat-icon>clear_all</mat-icon> CLEAR
    </button>
  </div>
</div>
