<div *ngIf="persona; else noPersona"
     gdColumns.gt-sm="320px auto"
     gdRows="max-content auto"
     gdRows.gt-sm
     gdGap="16px">
  <div fxLayout="column" fxLayoutGap="16px">
    <mat-card>
      <mat-card-header>
        <mat-card-title>{{ persona.name }}</mat-card-title>
        <mat-card-subtitle
          >{{ persona.arcanaName }} / Level
          {{ persona.level }}</mat-card-subtitle
        >
      </mat-card-header>
      <mat-card-content>
        <mat-chip-list>
          <mat-chip *ngIf="persona.special" color="warn" selected
            >Special fusion</mat-chip
          >
          <mat-chip *ngIf="persona.specialCondition" color="accent" selected>{{
            persona.specialCondition
          }}</mat-chip>
          <mat-chip *ngIf="persona.ultimate" color="accent" selected
            >Ultimate Persona</mat-chip
          >
          <mat-chip *ngIf="persona.keyItem">Key item</mat-chip>
        </mat-chip-list>
      </mat-card-content>
    </mat-card>

    <mat-expansion-panel expanded>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Base Stats
        </mat-panel-title>
        <mat-panel-description>
          <small> 
            <span *ngFor="let stat of stats()" style="padding-right: 8px"> {{stat | uppercase}}: {{persona.stats[stat]}} </span>
          </small>
        </mat-panel-description>
      </mat-expansion-panel-header>
      <table>
        <tr *ngFor="let stat of stats()">
          <td style="width: 24px; padding-right: 8px"><small class="mat-body-1">{{stat | uppercase}}</small></td>
          <td style="width: 100%"><mat-progress-bar mode="determinate" value="{{persona.stats[stat] / .99}}">
            </mat-progress-bar>
          </td>
          <td style="width: 24px; padding-left: 8px"><small class="mat-body-1">{{persona.stats[stat]}}</small></td>
        </tr>
      </table>
    </mat-expansion-panel>

    <mat-expansion-panel expanded>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Affinities
        </mat-panel-title>
        <mat-panel-description>
          <small>
            <span *ngFor="let element of affinities()">
              {{persona.affinities[element]}}
            </span>
          </small>
        </mat-panel-description>
      </mat-expansion-panel-header>
      <table style="width: 100%">
        <tr *ngFor="let element of affinities()">
          <td style="width: 50%">{{element | titlecase}}</td>
          <td style="width: 50%">{{ { s: 'Strong', w: 'Weak', 'd': 'Absorb', r: 'Repel', n: 'Block', '-': '--' }[persona.affinities[element]]}}</td>
        </tr>
      </table>
    </mat-expansion-panel>

    <mat-expansion-panel expanded>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Skills
        </mat-panel-title>
        <mat-panel-description style="">
          <small style="text-overflow: ellipsis;">
            {{skills()}}
          </small>
        </mat-panel-description>
      </mat-expansion-panel-header>
      <table style="width: 100%">
        <tr *ngFor="let skill of persona.skills">
          <td style="width: 50%">{{skill.name}}</td>
          <td style="width: 50%">{{skill.level === 0 ? 'Innate' : 'Lv. ' + skill.level}}</td>
        </tr>
      </table>
    </mat-expansion-panel>
  </div>

  <mat-card class="mat-elevation-z2"
            *ngIf="persona.special; else nonSpecial"
            id="special-fusions-container">
    <mat-tab-group>
      <mat-tab label="SPECIAL FUSION">
        <mat-nav-list>
          <a mat-line mat-list-item *ngFor="let p of specialFusions"
             routerLink="..//{{ p.name | lowercase }}">
             <span mat-line>{{p.name}}</span>
             <span mat-line>{{ p.arcanaName }} / Level {{ p.level }}</span>
          </a>          
        </mat-nav-list>
        <a mat-flat-button color="primary" routerLink="../../simulator" [queryParams]="queryParams()"
           style="width: 100%; margin-top: 16px">SIMULATE</a>
      </mat-tab>
    </mat-tab-group>
  </mat-card>

</div>

<ng-template #noPersona>
  <p class="mat-body-1">
    Persona not found.
  </p>
  <a routerLink="../.." mat-button color="accent">GO BACK</a>
</ng-template>

<ng-template #nonSpecial>
  <mat-card class="mat-elevation-z2">
    <mat-tab-group>
      <mat-tab label="NORMAL">
        <game-normal-fusions [persona]="persona"></game-normal-fusions>
      </mat-tab>
      <mat-tab label="TRIANGLE">
        <game-triangle-fusions [persona]="persona"></game-triangle-fusions>
      </mat-tab>
    </mat-tab-group>
  </mat-card>
</ng-template>
